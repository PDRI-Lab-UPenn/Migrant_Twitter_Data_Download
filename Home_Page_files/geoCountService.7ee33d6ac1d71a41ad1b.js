(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{354:function(e,t,n){"use strict";n.r(t),n.d(t,"GeoCountService",(function(){return d}));n(30),n(24),n(8),n(20),n(29),n(212),n(139),n(141),n(222);function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a=function(){function e(t){var n=t.count,o=t.country,a=t.state;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r(this,"count",void 0),r(this,"country",void 0),r(this,"state",void 0),this.count="string"==typeof n?parseInt(n,10):n,this.country=o,this.state=a}var t,n,a;return t=e,(n=[{key:"formattedCount",get:function(){return this.count.toLocaleString()}}])&&o(t.prototype,n),a&&o(t,a),e}();n(25);function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var c=function(){function e(t){var n=t.code,o=t.name;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),u(this,"code",void 0),u(this,"name",void 0),this.code=n,this.name=o}var t,n,o;return t=e,o=[{key:"capitalizeFirstLetter",value:function(e){return e.charAt(0).toUpperCase()+e.slice(1)}}],(n=[{key:"formattedName",get:function(){return e.capitalizeFirstLetter(this.name)}}])&&i(t.prototype,n),o&&i(t,o),e}();function s(e,t,n,o,r,a,i){try{var u=e[a](i),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(o,r)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var d=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.DEFAULT_BASE_URL,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.DEFAULT_API_PATH;l(this,e),this.baseUrl=t,this.apiPath=n}var t,n,o,r,i;return t=e,n=[{key:"getGeoCounts",value:(r=regeneratorRuntime.mark((function t(n){var o,r,a,i,u,c,s,l,f,v=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=v.length>1&&void 0!==v[1]?v[1]:{},r=o.days,a=void 0===r?30:r,i=o.limit,u=void 0===i?100:i,c=o.allowedUAKinds,s=void 0===c?["robot","non_robot","unrecognized"]:c,l="".concat(this.baseUrl).concat(this.apiPath,"/").concat(n,"/").concat(a),t.prev=2,t.next=5,fetch(l);case 5:return t.next=7,t.sent.json();case 7:return f=t.sent,t.abrupt("return",e.createCombinedGeoCountsFromApiData(f,{allowedUAKinds:s}).sort((function(e,t){return t.count-e.count})).slice(0,u));case 11:return t.prev=11,t.t0=t.catch(2),console.warn("Unable to get region view counts:",t.t0),t.abrupt("return",null);case 15:case"end":return t.stop()}}),t,this,[[2,11]])})),i=function(){var e=this,t=arguments;return new Promise((function(n,o){var a=r.apply(e,t);function i(e){s(a,n,o,i,u,"next",e)}function u(e){s(a,n,o,i,u,"throw",e)}i(void 0)}))},function(e){return i.apply(this,arguments)})}],o=[{key:"createCombinedGeoCountsFromApiData",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=n.allowedUAKinds,r=void 0===o?["robot","non_robot","unrecognized"]:o;if(!t.counts_geo)throw new RangeError("API response doesn't contain property 'counts_geo'.");for(var a={},i=0;i<t.counts_geo.length;i++){var u=t.counts_geo[i],c=r.includes(null==u?void 0:u.ua_kind),s="unknown"!==(null==u?void 0:u.country);if(c&&s){var l="".concat(u.geo_country,"_").concat(u.geo_state),f=a[l];f?f.count+=u.sum_count_value:a[l]=e.createGeoCountFromApiData(u)}}return Object.values(a)}},{key:"createGeoCountFromApiData",value:function(e){return new a({count:e.sum_count_value,country:new c({code:e.geo_country,name:e.country}),state:new c({code:e.geo_state,name:e.state})})}}],n&&f(t.prototype,n),o&&f(t,o),e}();v(d,"DEFAULT_BASE_URL","https://be-api.us.archive.org"),v(d,"DEFAULT_API_PATH","/views/v1/detail/collection")}}]);
//# sourceMappingURL=geoCountService.7ee33d6ac1d71a41ad1b.js.map